- name: Deploy Machine Learning Services
  hosts:
    - machine_learning
  remote_user: root
  gather_facts: true

  tasks:
    - name: Setup basic services and environment
      block:
        - import_role:
            name: docker
        - import_role:
            name: edgetpu
      tags:
        - always
    
    - name: Setup machine learning services
      block: 

        - name: NVidia CUDA
          block:
            - import_role:
                name: nvidia-cuda
            - import_role:
                name: nvidia-docker
          tags:
            - cuda
      when:
        - '"machine_learning" in group_names'
      tags:
        - cuda

    - name: Configure metrics and logging
      block:
        - import_role:
            name: telegraf
      tags:
        - always

